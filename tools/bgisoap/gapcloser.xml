<tool id="gapcloser" name="gapcloser" version="0.1">
    <description>- close gaps in SOAPdenovo scaffolds</description>
    <command interpreter="python">
        gapcloser.py

        ## Inputs
        --scaffold=$scaffold ##Input scaffold file name
        --configinfo=$configinfo ##This input is the same configuration file used for SOAPdenovo

        ##Output
        --outfile=$outfile
        --fill=$fill

        ## Check if using default or custom parameters
        --default_full_settings_type=$default_full_settings.settings_type
        #if $default_full_settings.settings_type == "full"
        --max_read_len=$max_read_len
        --overlap_param=$overlap_param
        --thread_num=$thread_num
        #end if
    </command>
    <requirements>
        <requirement type="package">bgisoap</requirement>
    </requirements>
    <inputs>
        <param name="scaffold" type="data" format="input" label="Scaffold file"/>
        <param name="configinfo" type="data" label="input" value="Configuration information"/>

        <conditional name="default_full_settings">
            <param name="settings_type" type="select" label="GapCloser settings to use" help="For full control of this function, please use Full Parameter List">
                <option value="default">Default</option>
                <option value="full">Full parameter list</option>
            </param>
            <when value="default" />
            <when value="full">
                <param name="max_read_len" type="integer" value="100" label="Maximum read length" max="155"/>
                <param name="overlap_param" type="integer" value="25" label="Overlap parameter" max="31"/>
                <param name="thread_num" type="integer" value="1" label="Number of threads" max="20"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="outfile" format="Tabular" label="Output file"/>
        <data name="fill" format="Tabular" label="Gap information"/>
    </outputs>
    <tests>
        <test>
            <!--
                GapCloser –b config_file –a scaffold_file –o output_file
            -->
            <param name="refGenomeSource" value="indexed" />
            <param name="indices" value="phiX" />
            <param name="sPaired" value="single" />
            <param name="input1" value="bwa_wrapper_in1.fastqsanger" ftype="fastqsanger" />
            <param name="source_select" value="pre_set" />
            <param name="suppressHeader" value="true" />
            <output name="output" file="bwa_wrapper_out1.sam" ftype="sam" sort="True" />
        </test>
    </tests>
    <help>
**What it does**

GapCloser closes gaps emerging from the scaffolding process by SOAPdenovo by using the abundant pair relationships of short reads.

-----

**How it works**

GapCloser can be used for the construction of large plant and animal genomes. It also works well on bacteria and fungi genomes.

Memory use is mainly related to the read number and the number of unique Kmers in the reads. A read shorter than 60 bp occupies 24 Bytes, a read shorter than 92bp occupies 32 Bytes, and a Kmer needs 4 Bytes.

The time consumption depends on gap number, gap size and read number.

Using the assembly of the Giant Panda genome as an example, the maximum memory used by GapCloser was about 150G and the time cost was about 4 days.

-----

**Outputs**

Two output files are generated by GapCloser:

1. One file (named by -o) contains scaffold sequences with some gaps filled.
2. The *.fill file containing information about the gaps in the scaffolds. The first column is the starting position of a gap in the output sequence. The second is the end position. The third and fourth are the length of sequences extending separately from the left and right boundaries of a gap. The status of the gaps can be seen from the fifth column of the file.  If a gap was finished through the overlapping of Kmers, the flag was set to 1, otherwise 0.

-----

**Questions**

1. What pair ends should be used for gap filling?

GapCloser mainly uses read pairs with short and medium insert sizes, although the long insert PE reads (>2K) may also help.
It is recommended that the reads be corrected with the program Corrector before gap filling, both for the consideration of memory usage and accuracy of gap sequences produced at this stage.

2. How to set maximal read length (default 60)?

The maximal read length is indicated in the configure file as “max_rd_len”.

3. What’s the sequence quality produced during gap filling?

The sequence quality is statistically lower than that of the sequences on both sides of the gaps.
    </help>
</tool>


